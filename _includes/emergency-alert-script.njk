<script>
    /* global fetch */
    const wvuEmergencyAlert = (() => {
        'use strict';
        const getEmergencyEl = document.querySelector('#js-emergency-alert');
        if (!getEmergencyEl) return;
        const getEmergencyEvents = getEmergencyEl.querySelector('#js-emergency-alert__events');
        const getEmergencyDomain = getEmergencyEl.querySelector('#js-emergency-alert-domain');
        const disableAlert = getEmergencyEl.dataset.disableEmergencyAlert || 'false';
        const emergencyAlertUrl = getEmergencyEl.dataset.emergencyAlertJsonFeed || 'https://emergency.wvu.edu/emergency.json';
        if (!emergencyAlertUrl) return;
        const isTrue = (value) => {
            if (typeof (value) === 'string') value = value.trim().toLowerCase();
            switch (value) {
                case true: case 'true': case 1: case '1': case 'on': case 'On': case 'yes': case 'Yes': return true;
                default: return false;
            }
        };
        const fetchData = async (apiUrl) => {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('WVU Emergency Alert response was not OK: ' + response.status);
                return await response.json();
            } catch (error) { console.error('Error fetching WVU Emergency Alert:', error.message); }
        };
        const getDomain = (url) => {
            const makeUrl = new URL(url);
            return [makeUrl.host, makeUrl.origin];
        };
        const renderMoreInfoLink = (url) => {
            const rootUrl = getDomain(url || emergencyAlertUrl);
            getEmergencyDomain.innerText = rootUrl[0];
            getEmergencyDomain.href = rootUrl[1];
        };
        const renderAlert = (events) => {
            getEmergencyEvents.innerHTML = events.map((item) => {
                const e = item.event;
                return `<div class="event mt-3"><h3 class="h5 mb-1">${e.title}</h3><p class="small"><time datetime="${e.updated_at}">${e.updated_at_formatted}</time></p>${e.body}</div>`;
            }).join('');
            renderMoreInfoLink();
            getEmergencyEl.classList.remove('d-none');
        };
        (async () => {
            if (isTrue(disableAlert)) return;
            const apiResponse = await fetchData(emergencyAlertUrl);
            if (!apiResponse || !apiResponse.emergency || !apiResponse.emergency.status) return;
            renderAlert(apiResponse.emergency.events);
        })();
    })();
</script>
